<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Penalty Shootout</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</head>
<body class="bg-green-700 font-sans">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;
        const { createRoot } = ReactDOM;

        // The main App component that contains the entire game
        const App = () => {
            const [gameState, setGameState] = useState('start'); // 'start', 'kicking', 'goal', 'save', 'gameover'
            const [userScore, setUserScore] = useState(0);
            const [computerScore, setComputerScore] = useState(0);
            const [goalkeeperPosition, setGoalkeeperPosition] = useState('center');
            const [message, setMessage] = useState('');
            const [kickerChoice, setKickerChoice] = useState(null);
            const [shotResult, setShotResult] = useState(null);
            const [round, setRound] = useState(0); // Tracks current round (0-4)
            const [userShotHistory, setUserShotHistory] = useState([]); // Tracks user's goals and saves
            const [computerShotHistory, setComputerShotHistory] = useState([]); // Tracks computer's goals and saves
            const [isUserTurn, setIsUserTurn] = useState(true);
            const [ballPosition, setBallPosition] = useState({ x: 0, y: 0 });
            const [isBallMoving, setIsBallMoving] = useState(false);
            const [isPullingBack, setIsPullingBack] = useState(false);
            const [pullStartPosition, setPullStartPosition] = useState(null);
            const [pullEndPosition, setPullEndPosition] = useState(null);
            const maxRounds = 5;
            const fieldRef = useRef(null);

            // Returns a random position for a save or kick
            const getRandomPosition = () => {
                const positions = ['left', 'center', 'right'];
                return positions[Math.floor(Math.random() * positions.length)];
            };

            const startGame = () => {
                setUserScore(0);
                setComputerScore(0);
                setRound(0);
                setUserShotHistory([]);
                setComputerShotHistory([]);
                setIsUserTurn(true);
                setGameState('kicking');
                setMessage('It\'s your turn to kick! Pull back to aim and shoot!');
                resetBall();
            };
            
            const resetBall = () => {
                if (fieldRef.current) {
                    // Start the ball at the bottom center of the field, further back
                    setBallPosition({
                        x: fieldRef.current.offsetWidth / 2,
                        y: fieldRef.current.offsetHeight - 150
                    });
                }
                setIsBallMoving(false);
            };

            const handleDragStart = (event) => {
                if (isUserTurn && gameState === 'kicking' && !isBallMoving) {
                    const clientX = event.clientX || event.touches[0].clientX;
                    const clientY = event.clientY || event.touches[0].clientY;
                    const fieldRect = fieldRef.current.getBoundingClientRect();
                    const x = clientX - fieldRect.left;
                    const y = clientY - fieldRect.top;
                    
                    setPullStartPosition({ x, y });
                    setIsPullingBack(true);
                    setBallPosition({ x, y }); // Move the ball to the start position of the drag
                }
            };
            
            const handleDragMove = (event) => {
                if (isUserTurn && isPullingBack) {
                    const clientX = event.clientX || event.touches[0].clientX;
                    const clientY = event.clientY || event.touches[0].clientY;
                    const fieldRect = fieldRef.current.getBoundingClientRect();
                    const x = clientX - fieldRect.left;
                    const y = clientY - fieldRect.top;
                    setPullEndPosition({ x, y });
                }
            };

            const handleDragEnd = (event) => {
                if (isUserTurn && isPullingBack) {
                    setIsPullingBack(false);
                    const clientX = event.clientX || event.changedTouches[0].clientX;
                    const clientY = event.clientY || event.changedTouches[0].clientY;
                    const fieldRect = fieldRef.current.getBoundingClientRect();
                    const endX = clientX - fieldRect.left;
                    const endY = clientY - fieldRect.top;
                    const startX = pullStartPosition.x;
                    const startY = pullStartPosition.y;

                    // Calculate shot vector
                    const vectorX = startX - endX;
                    const vectorY = startY - endY;
                    const magnitude = Math.sqrt(vectorX * vectorX + vectorY * vectorY);
                    
                    if (magnitude > 10) { // A small threshold to prevent accidental shots
                        setIsBallMoving(true);
                        
                        // Set the initial target position based on the drag vector
                        const fieldWidth = fieldRect.width;
                        const fieldHeight = fieldRect.height;
                        const targetX = startX + vectorX * 3;
                        const targetY = startY + vectorY * 2;
                        
                        setBallPosition({ x: targetX, y: targetY });

                        // Determine shot direction for game logic
                        let choice;
                        if (targetX < fieldWidth * 0.4) {
                            choice = 'left';
                        } else if (targetX > fieldWidth * 0.6) {
                            choice = 'right';
                        } else {
                            choice = 'center';
                        }

                        setKickerChoice(choice);
                        const savePosition = getRandomPosition();
                        setGoalkeeperPosition(savePosition);
                        
                        setTimeout(() => {
                            const isGoal = choice !== savePosition;
                            setShotResult(isGoal ? 'goal' : 'save');

                            if (isGoal) {
                                setUserScore(userScore + 1);
                                setMessage('GOOOOAL! You scored!');
                                setUserShotHistory(prev => [...prev, 'goal']);
                            } else {
                                setMessage('Neelama made a great save!');
                                setUserShotHistory(prev => [...prev, 'save']);
                            }
                            
                            // Adjust the ball's final position to be visible inside the goal
                            let finalX;
                            switch (choice) {
                                case 'left': finalX = fieldWidth * 0.4; break;
                                case 'center': finalX = fieldWidth * 0.5; break;
                                case 'right': finalX = fieldWidth * 0.6; break;
                            }
                            // The new Y position is slightly higher to ensure it's not hidden by the border
                            setBallPosition({ x: finalX, y: fieldHeight * 0.1 }); 

                            setGameState('completed_shot');
                        }, 1200); // Wait for the animation to complete
                    } else {
                        // Reset if drag was too short
                        resetBall();
                    }
                }
                setPullStartPosition(null);
                setPullEndPosition(null);
            };

            const handleUserSaveAction = (choice) => {
                if (gameState !== 'kicking' || isBallMoving) return;
                
                // User is the goalkeeper, computer is the kicker
                const kickPosition = getRandomPosition();
                setKickerChoice(kickPosition);
                setGoalkeeperPosition(choice);
                
                setIsBallMoving(true);
                const fieldRect = fieldRef.current.getBoundingClientRect();
                const fieldWidth = fieldRect.width;
                const fieldHeight = fieldRect.height;
                
                let targetX;
                switch (kickPosition) {
                    case 'left': targetX = fieldWidth * 0.4; break;
                    case 'center': targetX = fieldWidth / 2; break;
                    case 'right': targetX = fieldWidth * 0.6; break;
                }
                setBallPosition({ x: targetX, y: fieldRect.height * 0.3 }); // Kick target position
                
                setTimeout(() => {
                    const isGoal = choice !== kickPosition;
                    setShotResult(isGoal ? 'goal' : 'save');
                    
                    if (isGoal) {
                        setComputerScore(computerScore + 1);
                        setMessage('The ball flew past you! GOOOOAL!');
                        setComputerShotHistory(prev => [...prev, 'goal']);
                    } else {
                        setMessage('You made an incredible save!');
                        setComputerShotHistory(prev => [...prev, 'save']);
                    }

                    // Adjust the ball's final position to be visible inside the goal
                    let finalX;
                    switch (kickPosition) {
                        case 'left': finalX = fieldWidth * 0.4; break;
                        case 'center': finalX = fieldWidth * 0.5; break;
                        case 'right': finalX = fieldWidth * 0.6; break;
                    }
                    // The new Y position is slightly higher to ensure it's not hidden by the border
                    setBallPosition({ x: finalX, y: fieldHeight * 0.1 });
                    
                    setGameState('completed_shot');
                }, 1200);
            };
            
            const nextShot = () => {
                setKickerChoice(null);
                setGoalkeeperPosition('center');
                resetBall();
                
                // Check if the game is over
                if (round + 1 >= maxRounds) {
                    setGameState('gameover');
                    let finalMessage;
                    if (userScore > computerScore) {
                        finalMessage = `You won the match! Final score: ${userScore} - ${computerScore}.`;
                    } else if (computerScore > userScore) {
                        finalMessage = `You lost the match. Final score: ${userScore} - ${computerScore}.`;
                    } else {
                        finalMessage = `It's a draw! Final score: ${userScore} - ${computerScore}.`;
                    }
                    setMessage(finalMessage);
                } else {
                    // Continue the game
                    setIsUserTurn(!isUserTurn);
                    if (!isUserTurn) {
                        setRound(round + 1);
                    }
                    
                    if (!isUserTurn) {
                        setMessage('It\'s your turn to kick! Pull back to aim and shoot!');
                        setGameState('kicking');
                    } else {
                        setMessage('It\'s Neelama\'s turn to kick. Choose a direction!');
                        setGameState('kicking');
                    }
                }
            };

            const restartGame = () => {
                setGameState('start');
                setGoalkeeperPosition('center');
                setKickerChoice(null);
                setShotResult(null);
                setMessage('');
                startGame(); // Automatically start a new game
            };

            useEffect(() => {
                resetBall();
            }, []);

            useEffect(() => {
                if (gameState === 'start') {
                    setMessage('You are about to play a match with Neelama.');
                }
            }, [gameState]);
            
            const Player = ({ role, position }) => {
                const getPositionStyle = () => {
                    if (role === 'kicker') {
                        return { bottom: '5%', left: '50%', transform: 'translateX(-50%)' };
                    } else {
                        let leftPos = '50%';
                        if (position === 'left') leftPos = '40%';
                        if (position === 'right') leftPos = '60%';
                        return { top: '10%', left: leftPos, transform: 'translateX(-50%)', transition: 'left 0.7s ease-in-out' };
                    }
                };
                
                const PlayerSVG = () => (
                    <svg viewBox="0 0 100 100" class="w-12 h-12 md:w-16 md:h-16">
                        <circle cx="50" cy="50" r="45" fill="black" />
                        <circle cx="50" cy="50" r="40" fill="#2d6a4f" />
                        <rect x="30" y="5" width="40" height="20" rx="10" ry="10" fill="white" />
                        <rect x="40" y="10" width="20" height="10" rx="5" ry="5" fill="black" />
                        <rect x="45" y="15" width="10" height="5" fill="#fcfcff" />
                    </svg>
                );
                
                const GoalkeeperSVG = () => (
                    <svg viewBox="0 0 100 100" class="w-16 h-16 md:w-20 md:h-20">
                        {/* Body */}
                        <rect x="25" y="30" width="50" height="40" fill="#4299e1" rx="10" ry="10" stroke="black" strokeWidth="2" />
                        {/* Head */}
                        <circle cx="50" cy="20" r="20" fill="beige" stroke="black" strokeWidth="2" />
                        {/* Hair */}
                        <path d="M 30 15 Q 40 5, 50 15 T 70 15" fill="black" stroke="black" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" />
                        {/* Eyes */}
                        <circle cx="40" cy="22" r="2" fill="black" />
                        <circle cx="60" cy="22" r="2" fill="black" />
                        {/* Arms */}
                        <rect x="15" y="35" width="10" height="25" fill="#4299e1" rx="5" ry="5" stroke="black" strokeWidth="2" />
                        <rect x="75" y="35" width="10" height="25" fill="#4299e1" rx="5" ry="5" stroke="black" strokeWidth="2" />
                        {/* Legs */}
                        <rect x="35" y="70" width="15" height="20" fill="#2d6a4f" rx="5" ry="5" stroke="black" strokeWidth="2" />
                        <rect x="50" y="70" width="15" height="20" fill="#2d6a4f" rx="5" ry="5" stroke="black" strokeWidth="2" />
                        {/* Feet */}
                        <circle cx="42" cy="90" r="5" fill="#8b4513" stroke="black" strokeWidth="2" />
                        <circle cx="58" cy="90" r="5" fill="#8b4513" stroke="black" strokeWidth="2" />
                    </svg>
                );

                return (
                    <div className="absolute" style={getPositionStyle()}>
                        {role === 'goalkeeper' ? <GoalkeeperSVG /> : <PlayerSVG />}
                    </div>
                );
            };

            const Ball = () => {
                return (
                    <div 
                        className={`absolute w-6 h-6 md:w-8 md:h-8 transition-all duration-1000 ease-linear`}
                        style={{
                            left: ballPosition.x,
                            top: ballPosition.y,
                            transform: `translate(-50%, -50%)`,
                        }}
                    >
                        {/* Ball SVG icon */}
                        <svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                            <circle cx="50" cy="50" r="45" fill="white" stroke="black" stroke-width="5" />
                            <path d="M 50 50 L 50 95" stroke="black" stroke-width="5" />
                            <path d="M 50 50 L 50 5" stroke="black" stroke-width="5" />
                            <path d="M 50 50 L 95 50" stroke="black" stroke-width="5" />
                            <path d="M 50 50 L 5 50" stroke="black" stroke-width="5" />
                            <path d="M 50 50 L 85 85" stroke="black" stroke-width="5" />
                            <path d="M 50 50 L 15 15" stroke="black" stroke-width="5" />
                            <path d="M 50 50 L 85 15" stroke="black" stroke-width="5" />
                            <path d="M 50 50 L 15 85" stroke="black" stroke-width="5" />
                        </svg>
                    </div>
                );
            };
            
            const PullBackIndicator = () => {
                if (!isPullingBack || !pullStartPosition || !pullEndPosition) {
                    return null;
                }
                const dx = pullEndPosition.x - pullStartPosition.x;
                const dy = pullEndPosition.y - pullStartPosition.y;
                const angle = Math.atan2(dy, dx) * 180 / Math.PI;
                const distance = Math.sqrt(dx * dx + dy * dy);

                return (
                    <div
                        className="absolute w-2 h-16 bg-blue-500 rounded-full"
                        style={{
                            left: pullStartPosition.x,
                            top: pullStartPosition.y,
                            transform: `translate(-50%, -100%) rotate(${angle - 90}deg)`,
                            transformOrigin: 'bottom center',
                            height: `${distance}px`
                        }}
                    ></div>
                );
            };

            const Scorecard = ({ history }) => (
                <div className="flex justify-center items-center space-x-2 md:space-x-4">
                    {Array.from({ length: maxRounds }).map((_, index) => {
                        const shot = history[index];
                        const getShotColor = () => {
                            if (shot === 'goal') {
                                return 'bg-green-600'; // Goal is always a success
                            } else if (shot === 'save') {
                                return 'bg-red-600'; // Save (miss) is always a failure
                            }
                            return 'bg-gray-300';
                        };
                        return (
                            <div 
                                key={index} 
                                className={`
                                    w-6 h-6 md:w-8 md:h-8 rounded-full 
                                    border-2 border-green-900
                                    ${getShotColor()}
                                    transition-colors duration-300 ease-in-out
                                `}
                            ></div>
                        );
                    })}
                </div>
            );

            return (
                <div className="bg-green-700 min-h-screen flex flex-col items-center justify-center p-4">
                    <div className="bg-white rounded-xl shadow-2xl p-6 md:p-10 w-full max-w-2xl text-center">
                        <h1 className="text-4xl md:text-5xl font-extrabold text-green-900 mb-4">
                            Penalty Shootout
                        </h1>
                        <div className="flex justify-around items-center w-full mb-4">
                            <div className="flex flex-col items-center">
                                <h2 className="text-2xl font-bold text-gray-800">You</h2>
                                <p className="text-3xl font-extrabold text-gray-800">{userScore}</p>
                                <Scorecard history={userShotHistory} />
                            </div>
                            <div className="flex flex-col items-center">
                                <h2 className="text-2xl font-bold text-gray-800">Neelama</h2>
                                <p className="text-3xl font-extrabold text-gray-800">{computerScore}</p>
                                <Scorecard history={computerShotHistory} />
                            </div>
                        </div>

                        <div className="text-xl md:text-2xl font-semibold text-gray-600 mb-6">
                            Round: {round + 1} / {maxRounds}
                        </div>
                        <p className="text-lg md:text-xl font-medium text-gray-700 mb-8 h-10">
                            {message}
                        </p>

                        {/* Game state rendering */}
                        {gameState === 'start' && (
                            <div className="flex justify-center">
                                <button
                                    onClick={startGame}
                                    className="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-lg shadow-lg transition transform hover:scale-105"
                                >
                                    Start Match
                                </button>
                            </div>
                        )}

                        {(gameState === 'kicking' || gameState === 'completed_shot') && (
                            <>
                                {/* The Football Pitch (Top-Down View) */}
                                {isUserTurn ? (
                                    <div 
                                        ref={fieldRef}
                                        className="relative w-full h-96 bg-green-500 rounded-xl overflow-hidden mb-8 cursor-grab active:cursor-grabbing"
                                        onMouseDown={handleDragStart}
                                        onMouseMove={handleDragMove}
                                        onMouseUp={handleDragEnd}
                                        onTouchStart={handleDragStart}
                                        onTouchMove={handleDragMove}
                                        onTouchEnd={handleDragEnd}
                                    >
                                        {/* Field markings */}
                                        <div className="absolute top-1/2 left-0 w-full border-t-2 border-white"></div>
                                        <div className="absolute top-1/2 left-1/2 w-4 h-4 rounded-full bg-white transform -translate-x-1/2 -translate-y-1/2"></div>
                                        
                                        {/* Goal posts */}
                                        <div className="absolute top-0 left-1/2 transform -translate-x-1/2 w-64 h-16 bg-black">
                                            <div className="absolute left-0 w-full h-full border-4 border-white"></div>
                                            <div className="absolute top-0 left-0 h-full w-2 border-l border-white"></div>
                                            <div className="absolute top-0 right-0 h-full w-2 border-r border-white"></div>
                                            <div className="absolute top-0 left-0 w-full h-full bg-white bg-opacity-20 flex justify-center items-center"></div>
                                        </div>
                                        
                                        {/* Goalkeeper and Kicker SVGs */}
                                        <Player 
                                            role="goalkeeper"
                                            position={goalkeeperPosition}
                                        />
                                        <Player 
                                            role="kicker"
                                        />
                                        
                                        {/* Ball position is now controlled by state */}
                                        <Ball />
                                        <PullBackIndicator />
                                    </div>
                                ) : (
                                    <div 
                                        ref={fieldRef}
                                        className="relative w-full h-96 bg-green-500 rounded-xl overflow-hidden mb-8"
                                    >
                                        {/* Field markings */}
                                        <div className="absolute top-1/2 left-0 w-full border-t-2 border-white"></div>
                                        <div className="absolute top-1/2 left-1/2 w-4 h-4 rounded-full bg-white transform -translate-x-1/2 -translate-y-1/2"></div>
                                        
                                        {/* Goal posts */}
                                        <div className="absolute top-0 left-1/2 transform -translate-x-1/2 w-64 h-16 bg-black">
                                            <div className="absolute left-0 w-full h-full border-4 border-white"></div>
                                            <div className="absolute top-0 left-0 h-full w-2 border-l border-white"></div>
                                            <div className="absolute top-0 right-0 h-full w-2 border-r border-white"></div>
                                            <div className="absolute top-0 left-0 w-full h-full bg-white bg-opacity-20 flex justify-center items-center"></div>
                                        </div>
                                        
                                        {/* Goalkeeper and Kicker SVGs */}
                                        <Player 
                                            role="goalkeeper"
                                            position={goalkeeperPosition}
                                        />
                                        <Player 
                                            role="kicker"
                                        />
                                        
                                        {/* Ball position is now controlled by state */}
                                        <Ball />
                                    </div>
                                )}


                                {/* Action Buttons */}
                                <div className="flex justify-center space-x-4 md:space-x-8">
                                    {isUserTurn && gameState === 'completed_shot' && (
                                        <button
                                            onClick={nextShot}
                                            className="bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-6 rounded-lg shadow-lg transition transform hover:scale-105"
                                        >
                                            {round + 1 < maxRounds ? 'Next Shot' : 'See Final Result'}
                                        </button>
                                    )}
                                    {!isUserTurn && gameState === 'kicking' && (
                                        <>
                                            <button
                                                onClick={() => handleUserSaveAction('left')}
                                                className="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-lg shadow-lg transition transform hover:scale-105"
                                            >
                                                Dive Left
                                            </button>
                                            <button
                                                onClick={() => handleUserSaveAction('center')}
                                                className="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-lg shadow-lg transition transform hover:scale-105"
                                            >
                                                Stay Center
                                            </button>
                                            <button
                                                onClick={() => handleUserSaveAction('right')}
                                                className="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-lg shadow-lg transition transform hover:scale-105"
                                            >
                                                Dive Right
                                            </button>
                                        </>
                                    )}

                                    {!isUserTurn && gameState === 'completed_shot' && (
                                        <button
                                            onClick={nextShot}
                                            className="bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-6 rounded-lg shadow-lg transition transform hover:scale-105"
                                        >
                                            {round + 1 < maxRounds ? 'Next Shot' : 'See Final Result'}
                                        </button>
                                    )}
                                    {gameState === 'gameover' && (
                                        <button
                                            onClick={restartGame}
                                            className="bg-purple-600 hover:bg-purple-700 text-white font-bold py-3 px-6 rounded-lg shadow-lg transition transform hover:scale-105"
                                        >
                                            Play Again
                                        </button>
                                    )}
                                </div>
                            </>
                        )}
                    </div>
                </div>
            );
        };

        const rootElement = document.getElementById('root');
        const root = createRoot(rootElement);
        root.render(<App />);

    </script>
</body>
</html>
